(function(h){var l=400;h.fn.TouchBox=function(g){var c={drag:!0,resize:!0,callback_touches:null,callback_change:null};void 0!=g&&h.extend(c,g);this.each(function(){var e=h(this),f=0,g=0,m=0,n=0,p=0,k=0,j=!1,q=0,r=0;e.bind("touchstart",function(b){l+=1;e.css({zIndex:l});f=b.originalEvent.touches.length;j&&(j=!1);if(!j){var a=e.offset(),d=b.originalEvent.touches[0].pageX,h=b.originalEvent.touches[0].pageY;q=a.left;r=a.top;g=d-a.left;m=h-a.top}c.resize&&2==f&&(n=e.width(),p=e.height(),d=b.originalEvent.touches[0].pageX,
h=b.originalEvent.touches[0].pageY,a=b.originalEvent.touches[1].pageX-d,b=b.originalEvent.touches[1].pageY-h,k=Math.sqrt(a*a+b*b))}).bind("touchmove",function(b){null!=c.callback_touches&&c.callback_touches.apply(this,[f]);var a=!1;if(c.resize&&2==f){var d=b.originalEvent.touches[0].pageX,a=b.originalEvent.touches[0].pageY,d=b.originalEvent.touches[1].pageX-d,a=b.originalEvent.touches[1].pageY-a,a=Math.sqrt(d*d+a*a);e.offset();d=(a-k)/2;e.css({width:n+(a-k)+"px",height:p+(a-k)+"px",left:q-d+"px",
top:r-d+"px"});a=!0}c.drag&&(!j&&1==f)&&(d=b.originalEvent.touches[0].pageX,a=b.originalEvent.touches[0].pageY,e.css({left:d-g+"px",top:a-m+"px"}),a=!0);a&&null!=c.callback_change&&c.callback_change.apply(this,[]);b.preventDefault()}).bind("touchend",function(){f-=1;1==f&&(j=!0);null!=c.callback_touches&&c.callback_touches.apply(this,[f])})})};h(document).ready(function(){var g=h(".touch-box");0<g.length&&g.each(function(){var c=h(this),e={drag:!1,resize:!1},f=c.attr("data-resize"),g=c.attr("data-drag");
void 0!=f&&"true"==f&&(e.resize=!0);void 0!=g&&"true"==g&&(e.drag=!0);c.TouchBox(e)})})})(jQuery);
